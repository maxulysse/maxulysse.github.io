---
interface Props {
    lang?: string;
    title?: string;
    description?: string;
    author?: string;
    image?: { path: string };
}

import socialMedia from "../data/socialMedia.js";

const {
    lang = "en",
    title,
    description = "Interested in Bioinformatics, Reproducible Research, Automation, Data Integration and Visualization...",
    author = "maxulysse",
    image,
} = Astro.props as Props;

const siteTitle = "maxulysse.github.io";
const siteDescription = description;
const url = "https://maxulysse.github.io";

// Author info
const Authors = {
    maxulysse: {
        name: "Maxime U. Garcia",
        twitter: "gau",
        github: "maxulysse",
    },
};

const authorInfo = Authors[author as keyof typeof Authors] || Authors.maxulysse;

const pageTitle = title ? `${title}` : siteTitle;
const pageDescription = description || siteDescription;
const imageUrl = image?.path ? `${url}${image.path}` : undefined;

// Get current path for active nav highlighting
const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang={lang}>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <title>{pageTitle}</title>
        <meta name="description" content={pageDescription} />
        <meta property="og:title" content={pageTitle} />
        <meta property="og:description" content={pageDescription} />
        <meta property="og:site_name" content={siteTitle} />
        <meta name="twitter:title" content={pageTitle} />
        <meta name="twitter:description" content={pageDescription} />

        {imageUrl && <meta property="og:image" content={imageUrl} />}
        {imageUrl && <meta name="twitter:image" content={imageUrl} />}

        <meta name="author" content={authorInfo.name} />
        <meta name="twitter:site" content={`@${authorInfo.twitter}`} />
        <meta name="twitter:creator" content={`@${authorInfo.twitter}`} />
        {title && <meta property="og:type" content="article" />}

        <!-- Favicon -->
        <link
            rel="icon"
            type="image/x-icon"
            href="/assets/img/favicons/favicon.ico"
        />
        <link
            rel="apple-touch-icon"
            href="/assets/img/favicons/apple-touch-icon.png"
        />

        <!-- Bootstrap CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.6/css/academicons.min.css"
        />

        <!-- Custom styles -->
        <link rel="stylesheet" href="/assets/css/style.css" />

        <!-- Prism for code highlighting -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
        />
    </head>
    <body data-theme="light">
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light bg-light rounded">
                <a class="navbar-brand" href="/">
                    <img
                        class="brand-image logo brandicon"
                        src="/assets/img/avatar/owl.svg"
                        alt="Logo"
                    />
                    <strong>{siteTitle}</strong>
                </a>
                <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarCollapse"
                    aria-controls="navbarCollapse"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                >
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a
                                class={`nav-link ${currentPath.startsWith("/cv") ? "active" : ""}`}
                                href="/cv">CV</a
                            >
                        </li>
                        <li class="nav-item">
                            <a
                                class={`nav-link ${currentPath.startsWith("/publications") ? "active" : ""}`}
                                href="/publications">Publications</a
                            >
                        </li>
                        <li class="nav-item">
                            <a
                                class={`nav-link ${currentPath.startsWith("/tags") ? "active" : ""}`}
                                href="/tags">Tags</a
                            >
                        </li>
                        <li class="nav-item">
                            <a
                                class={`nav-link ${currentPath.startsWith("/archive") ? "active" : ""}`}
                                href="/archive">Archive</a
                            >
                        </li>
                        <li class="nav-item">
                            <a
                                class={`nav-link ${currentPath.startsWith("/about") ? "active" : ""}`}
                                href="/about">About</a
                            >
                        </li>
                    </ul>
                    <form
                        class="d-flex my-2 my-lg-0"
                        action="/search"
                        method="get"
                    >
                        <input
                            class="form-control me-sm-2"
                            type="text"
                            name="q"
                            placeholder="Search for..."
                            aria-label="Search"
                        />
                        <button
                            class="btn btn-outline-primary my-2 my-sm-0"
                            type="submit"
                        >
                            <i class="fa fa-search"></i> Go!
                        </button>
                        <button
                            id="theme-toggle"
                            class="btn btn-outline-secondary my-2 my-sm-0 ms-2"
                            type="button"
                            title="Toggle dark/light mode"
                            aria-label="Toggle dark/light mode"
                        >
                            <i class="fas fa-moon"></i>
                        </button>
                    </form>
                </div>
            </nav>

            <main class="page-content" aria-label="Content">
                <slot />
            </main>

            <footer class="blog-footer">
                <nav class="nav nav-footer justify-content-center">
                    <a
                        class="nav-link"
                        href="/rss.xml"
                        target="_blank"
                        rel="noopener"
                    >
                        <i class="fa footericon fa-rss-square fa-2x"></i>
                    </a>
                    {
                        socialMedia.map((item) => (
                            <a
                                class="nav-link"
                                href={item.url}
                                target="_blank"
                                rel={
                                    item.name === "Mastodon"
                                        ? "me noopener"
                                        : "noopener"
                                }
                            >
                                {item.icon_svg && (
                                    <img
                                        class="footericon-img"
                                        src={item.icon_svg}
                                        alt={item.name}
                                    />
                                )}
                                {!item.icon_svg && item.font_awesome && (
                                    <i
                                        class={`fab footericon ${item.font_awesome} fa-2x`}
                                    />
                                )}
                                {!item.icon_svg && item.academicons && (
                                    <i
                                        class={`ai footericon ${item.academicons} ai-2x`}
                                    />
                                )}
                            </a>
                        ))
                    }
                </nav>
                <small>
                    Under{" "}
                    <a
                        href="https://creativecommons.org/licenses/by-sa/4.0/"
                        target="_blank"
                        rel="noopener"
                    >
                        <i class="fab fa-creative-commons fa-1x"></i>
                    </a>
                    {" "}and powered by{" "}
                    <a
                        href="https://astro.build/"
                        target="_blank"
                        rel="noopener"
                    >
                        Astro
                    </a>
                </small>
            </footer>
        </div>

        <!-- Bootstrap JS (no jQuery needed for BS5) -->
        <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        ></script>

        <!-- Prism for code highlighting -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"
        ></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"
        ></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"
        ></script>

        <!-- Theme toggle script -->
        <script>
            // Initialize theme from localStorage or system preference
            function initTheme() {
                const savedTheme = localStorage.getItem("theme");
                const prefersDark = window.matchMedia(
                    "(prefers-color-scheme: dark)",
                ).matches;
                const theme = savedTheme || (prefersDark ? "dark" : "light");

                document.body.setAttribute("data-theme", theme);
                updateThemeIcon(theme);
            }

            function updateThemeIcon(theme: string) {
                const icon = document.querySelector("#theme-toggle i");
                if (icon) {
                    if (theme === "dark") {
                        icon.classList.remove("fa-moon");
                        icon.classList.add("fa-sun");
                    } else {
                        icon.classList.remove("fa-sun");
                        icon.classList.add("fa-moon");
                    }
                }
            }

            function toggleTheme() {
                const currentTheme = document.body.getAttribute("data-theme");
                const newTheme = currentTheme === "dark" ? "light" : "dark";

                document.body.setAttribute("data-theme", newTheme);
                localStorage.setItem("theme", newTheme);
                updateThemeIcon(newTheme);
            }

            // Initialize on page load
            initTheme();

            // Add event listener to theme toggle button
            document
                .getElementById("theme-toggle")
                ?.addEventListener("click", toggleTheme);
        </script>
    </body>
</html>
